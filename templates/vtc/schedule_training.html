{% extends 'common/base.html' %}
{% load static %}

{% block content %}
<style>
  body { background-color: #f7fafd; }
  .btn-create { margin-bottom: 20px; }
</style>

<div class="container mt-4">
  <div class="row">
    
    <!-- Sidebar -->
    <div class="col-md-3">
      {% include 'vtc/sidebar.html' %}
    </div>

    <!-- Main Content -->
    <div class="col-md-9">

      <h2>Schedule Training for {{ worker.name }}</h2>
            {% include 'common/message.html' %}
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="from_date" class="form-label">From Date</label>
          <input type="date" name="from_date" id="from_date" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="to_date" class="form-label">To Date</label>
          <input type="date" name="to_date" id="to_date" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="type_of_training" class="form-label">Type of Training</label>
          <select name="type_of_training" id="type_of_training" class="form-select" required>
            <option value="">Select</option>
            <option value="Basic">Basic</option>
            <option value="Refresher">Refresher</option>
            <option value="Special">Special</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="nature_of_training" class="form-label">Nature of Training</label>
          <input type="text" name="nature_of_training" id="nature_of_training" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="contractor_name" class="form-label">Name of Contractor</label>
          <input type="text" name="contractor_name" id="contractor_name" class="form-control" required>
        </div>
        
        <!-- ðŸ”¥ AREA FIELD LOGIC -->
  {% if user_areas.count > 1 %}
    <div class="mb-3">
      <label class="form-label">Area</label>
      <select name="area_name" class="form-select" required>
        <option value="">Select Area</option>
        {% for area in user_areas %}
          <option value="{{ area.area_name }}">{{ area.area_name }}</option>
        {% endfor %}
      </select>
    </div>
  {% elif user_areas.count == 1 %}
    <!-- hidden auto value -->
    <input type="hidden" name="area_name" value="{{ user_areas.first.area_name }}">
    <div class="mb-3">
      <label class="form-label">Area</label>
      <input type="text" class="form-control" value="{{ user_areas.first.area_name }}" disabled>
    </div>
  {% else %}
    <div class="mb-3">
      <label class="form-label">Area</label>
      <input type="text" name="area_name" class="form-control" required>
    </div>
  {% endif %}


        <button type="submit" class="btn btn-primary">Submit</button>
        
      </form>

      <hr>

      <h4>Previous Training Schedules</h4>
      {% if worker.trainings.all %}
        <ul class="list-group">
          {% for training in worker.trainings.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>
              From: {{ training.from_date }} | To: {{ training.to_date }} | Created At: {{ training.created_at }}
            </span>
            <span>
              {% if training.vtc_status == "Pending" and training.created_by_id == request.user.id %}
                <a href="{% url 'vtc:edit_training' training.id %}" class="btn btn-sm btn-warning">Edit</a>
              {% else %}
                <a class="btn btn-sm btn-warning disabled" aria-disabled="true">Edit</a>
              {% endif %}
              <!--<form action="{% url 'vtc:delete_training' training.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this training schedule?');">Delete</button>
              </form>-->
            </span>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No previous trainings scheduled.</p>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
