{% extends 'common/base.html' %}
{% load static %}

{% block content %}

<style>
  body {
    background-color: #f4f7fb;
  }

  /* Main Card */
  .form-card {
    background: #ffffff;
    border-radius: 14px;
    border: 1px solid #e3e6ea;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    padding: 30px;
  }

  .form-card h3 {
    font-weight: 600;
    margin-bottom: 25px;
    color: #0d6efd;
  }

  /* Form Fields */
  .form-card p {
    margin-bottom: 14px;
  }

  .form-card label {
    font-weight: 500;
    margin-bottom: 4px;
    display: block;
  }

  .form-card input,
  .form-card select,
  .form-card textarea {
    width: 100%;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ced4da;
  }

  .form-card input[disabled],
  .form-card select[disabled],
  .form-card textarea[disabled] {
    background-color: #f1f3f5;
  }

  /* Certificate Card */
  .certificate-card {
    margin-top: 35px;
    border-radius: 14px;
    border: 1px solid #e3e6ea;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  .certificate-header {
    background: linear-gradient(90deg, #0d6efd, #4dabf7);
    color: white;
    padding: 14px 20px;
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
    font-weight: 600;
  }

  .table th {
    font-weight: 600;
  }

  .btn-pill {
    border-radius: 50px;
    padding: 4px 14px;
  }

</style>

<div class="container mt-4">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-md-3">
      {% include 'vtc/sidebar.html' %}
    </div>

    <!-- Main Content -->
    <div class="col-md-9">

      <!-- Worker Details Card -->
      <div class="form-card mt-3">
        <h3>
          {% if read_only %}
            Worker Details
          {% else %}
            Enter Worker Details
          {% endif %}
        </h3>

        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}

          {% for field in form %}
            <p>
              {{ field.label_tag }}

              {% if field.field.widget.input_type == "file" and field.value %}
                  <a href="{{ field.value.url }}" target="_blank">
                    View {{ field.label }}
                  </a>
              {% else %}
                  {{ field }}
              {% endif %}
            </p>
          {% endfor %}

          {% if not read_only %}
            <button type="submit" class="btn btn-primary btn-pill">Save</button>
            <a href="{% url 'vtc:worker_list' %}" class="btn btn-secondary btn-pill">Cancel</a>
          {% else %}
            <a href="{% url 'vtc:worker_list' %}" class="btn btn-outline-primary btn-pill">
              Back to List
            </a>
          {% endif %}
        </form>
      </div>


      <!-- ============================= -->
      <!-- Generated Certificates Section -->
      <!-- ============================= -->

      {% if read_only %}
      <div class="certificate-card mt-4">

        <div class="certificate-header">
          Generated Certificates
        </div>

        <div class="card-body p-3">

          {% if certificates %}
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Serial Number</th>
                  <th>Training Type</th>
                  <th>Training Period</th>
                  <th>Issue Date</th>
                  <th class="text-center">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for training in certificates %}
                <tr>
                  <td>
                    <strong>{{ training.certificate_serial_number_final }}</strong>
                  </td>
                  <td>{{ training.type_of_training }}</td>
                  <td>
                    {{ training.from_date|date:"d-m-Y" }}
                    to
                    {{ training.to_date|date:"d-m-Y" }}
                  </td>
                  <td>
                    {{ training.certificate_created_date|date:"d-m-Y" }}
                  </td>
                  <td class="text-center">
                    <a href="{% url 'vtc:certificate_detail' %}?serial_number={{ training.certificate_serial_number_final }}"
                       class="btn btn-sm btn-outline-primary btn-pill">
                      Verify
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% else %}
            <div class="text-muted">
              No certificates generated for this worker.
            </div>
          {% endif %}

        </div>
      </div>
      {% endif %}

    </div>
  </div>
</div>

{% endblock %}
